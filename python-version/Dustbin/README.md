# Bayer Channel Merger

A GUI application to merge three TIFF files (R, G, B channels) into a single 3-channel image. Specifically designed for processing RAW Bayer channel images from ToupCam SingleDroplet detection.

## Features

- **Easy File Selection**: Browse and select individual R, G, B channel files
- **Auto-Detection**: Automatically detect Bayer channel files in a directory
- **Multiple Merge Modes**: 
  - RGB Channel merge (standard)
  - Composite blend (additive)
- **Channel Normalization**: Optional intensity normalization
- **Live Preview**: Preview merged result before saving
- **Multiple Output Formats**: TIFF, PNG, JPEG support
- **Detailed Logging**: Real-time processing information

## Installation

1. Ensure Python 3.7+ is installed
2. Install required dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Running the Application
```bash
python bayer_channel_merger.py
```

### Basic Workflow

1. **Load Channel Files**:
   - Click "Browse" for each channel (R, G, B) to select TIFF files
   - OR use "Auto-Detect Bayer Files" to automatically find matching files

2. **Set Output**:
   - Specify output file path (auto-generated if using auto-detect)
   - Choose output format (.tif, .png, .jpg)

3. **Configure Options**:
   - Choose merge mode (RGB channels or composite blend)
   - Enable/disable channel normalization

4. **Process**:
   - Click "Preview" to see the result before saving
   - Click "Merge & Save" to create the final image

### File Naming Convention

The application expects Bayer channel files with this naming pattern:
- `timestamp_Bayer_R.tif` (Red channel)
- `timestamp_Bayer_G.tif` (Green channel)  
- `timestamp_Bayer_B.tif` (Blue channel)

Example: `12-05-55_Bayer_R.tif`, `12-05-55_Bayer_G.tif`, `12-05-55_Bayer_B.tif`

### Output

The merged image will be saved as:
- `timestamp_Merged_RGB.tif` (when using auto-detection)
- Or your specified filename

## Processing Modes

### RGB Channel Merge (Default)
- Combines R, G, B channels into standard RGB image
- Each channel occupies its respective color plane
- Best for standard image viewing and analysis

### Composite Blend
- Additive blending of all channels
- Creates artistic composite effect
- Useful for visualization of channel relationships

## Technical Details

- **Input**: Three TIFF files (896×507 pixels each, as generated by ToupCam RAW capture)
- **Output**: Single RGB image (896×507 pixels)
- **Supported Formats**: TIFF (lossless), PNG, JPEG
- **Color Space**: BGR (OpenCV standard)
- **Bit Depth**: 8-bit per channel output

## Integration with ToupCam

This tool is designed to work seamlessly with the RAW Bayer channel files generated by the ToupCam SingleDroplet detection application:

1. Capture in RAW mode using ToupCam application
2. Three Bayer channel files are automatically saved
3. Use this merger to combine them into a single RGB image
4. Result can be used for further analysis or viewing

## Troubleshooting

### Common Issues

1. **"Dimension Mismatch" Error**:
   - Ensure all three channel files have identical dimensions
   - Check that files are from the same capture session

2. **"Failed to Load" Error**:
   - Verify files are valid TIFF format
   - Check file permissions and paths

3. **Preview Not Working**:
   - Ensure PIL (Pillow) is installed correctly
   - Try different image formats

### Requirements

- Python 3.7+
- OpenCV (cv2)
- NumPy
- Pillow (PIL)
- tkinter (usually included with Python)

## License

This tool is part of the ToupCam CellToolbox project.
