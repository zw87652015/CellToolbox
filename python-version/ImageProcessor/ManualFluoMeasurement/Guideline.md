输入：一张 16-bit 单通道 TIFF，由 RawDigger 从 RGGB Bayer RAW 直接导出（灰度图里可见 2×2 棋盘）。
输出：每个细胞的相对荧光强度（扣除背景后的平均 R 值）与轮廓坐标列表，CSV 文件 + 可选叠加图。
1.文件路径与命名规范
1.1 RGGB主图像：windows路径规则，通过UI让用户选取，选取后在UI中打开，同时允许用户进行放大、缩小、平移视角等操作。图片使用邻近插值，以实现放大后像素分割清晰。
1.2 暗场图像：通过UI让用户选取（同一曝光、盖镜、无光照；若未拍摄，允许用主图四边角 50×50 pixel 的 median 代替）
1.3 输出文件：
- {主图像文件名}-cells.csv（每行一个细胞）
- {主图像文件名}-cells-overlay.png（8-bit 伪彩 + 绿色轮廓，供肉眼 QC）
- 储存路径通过UI让用户选取
2.读取与位深保护
2.1 必须按 16-bit 无符号整型读取；禁止提前转成 8-bit，防止量化误差。
2.2 若图宽高为奇数，抛异常提醒“Bayer 尺寸非法”。
3.Bayer 拆分（关键步骤，需写死 RGGB 顺序；这一步由UI按钮触发，用户可选择对其中一个子图进行显示并准备进行后续处理。图片使用邻近插值，以实现放大后像素分割清晰。）
3.1 R 子图：取偶行偶列 raw[0::2, 0::2] → 形状 (H/2, W/2)，称为 r_raw
3.2 G1 子图：取偶行奇列 raw[0::2, 1::2]
3.3 G2 子图：取奇行偶列 raw[1::2, 0::2]
3.4 B 子图：取奇行奇列 raw[1::2, 1::2]
3.5 后续只使用 R 子图；G1/G2/B 留空，便于以后扩展。
3.6 数据类型：先转 float32，再向下游传递。
4.黑电平扣除(在打开的r_raw窗口上的UI按钮触发，处理结果显示在r_flu窗口)
4.1 若存在UI用户提供的暗场图像：读取后同样按 3.1 取 R 子图，得到 dark_R。
4.2 若无：用主图 R 子图四边角 50×50 区域求 median 作为 dark_R。
4.3 执行 r_flu = r_raw - dark_R，负值裁 0。
4.4 打开 r_flu 窗口，允许用户进行放大、缩小、平移视角等操作。图片使用邻近插值，以实现放大后像素分割清晰。
5.空间滤波（去噪但保边，在r_flu窗口上的UI按钮触发，处理结果显示在r_gau窗口）
5.1 高斯模糊，σ = 0.8 pixel，kernel 自动 3×3 或 5×5。
5.2 禁止做强度归一化、直方图拉伸等会改变线性度的操作。
6.自动阈值分割（在r_gau窗口上的UI按钮触发，处理结果显示在r_bin窗口）
6.1 算法：Otsu（或 Triangle，若直方图单峰）。
6.2 输出：二值 mask（0 = 背景，1 = 前景）。
6.3 最小面积过滤：删除连通域 < 200 pixel（可调参数，写入 config 文件）。
6.4 形态学闭合：disk 半径 3 pixel，填缝隙但不改变整体面积。
7.轮廓追踪与 ROI 生成（在r_bin窗口上的UI按钮触发，处理结果显示在r_contour窗口）
7.1 使用 OpenCV findContours（mode=RETR_EXTERNAL, method=CHAIN_APPROX_SIMPLE）。
7.2 得到每个细胞的 (x,y) 点列列表；坐标系原点在图像左上角，x→宽，y→高。
7.3 对每个轮廓生成掩膜 mask_i（内部=1，外部=0），用于后续均值计算。
7.4 打开 r_contour 窗口，将细胞轮廓用绿色显示，允许用户进行放大、缩小、平移视角等操作。图片使用邻近插值，以实现放大后像素分割清晰。在放大后细胞轮廓应呈现锯齿状和像素对齐。
8.强度测量（在r_contour窗口上的UI按钮触发，处理结果在当前窗口显示）
8.1 对第 i 个细胞：
- area_i = Σ(mask_i)
- total_i = Σ(r_flu * mask_i)
- mean_i = total_i / area_i
8.2 写入 CSV 列：
label, area_pixel, mean_intensity, total_intensity, contour_csv
其中 contour_csv 为 “x1:y1|x2:y2|…” 便于后期重新绘图。
8.3 测量结果显示在当前窗口，将细胞面积显示在每个细胞边缘轮廓的左上角，字体小一点，颜色与轮廓一致，在放大缩小后文字大小保持不变，且应跟随视角平移。
8.4 提供UI按钮，点击后保存CSV文件，文件路径通过UI让用户选取。
9.质量控制图
9.1 生成 8-bit 伪彩图（jet 或 magma），叠加绿色轮廓。
9.2 在图右下角写入元信息：阈值、最小面积、细胞个数、平均 mean_intensity。
9.3 tiff无损保存。
10.日志与异常
10.1 全程写 logger.info（步骤、参数、检出细胞数）。
10.2 若最终细胞数 = 0，抛警告但正常退出，CSV 留空行表头。
10.3 任何一步读取失败或尺寸非法，记录 traceback 并退出码 1。

交付物 checklist
✅ 源码 + 单元测试（提供一张已知细胞数的样图，断言输出 CSV 行数）
✅ 配置文件（yaml）暴露：高斯σ、最小面积、阈值算法、环带宽度
✅ 要求文档：Python≥3.8, 依赖库版本锁定(requirements.txt)
✅ Readme：运行示例、结果列含义、故障排查（黑图/零细胞/尺寸奇数）