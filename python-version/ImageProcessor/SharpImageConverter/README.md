# 图像像素放大工具 (SharpImageConverter)

一个专业的图像像素级放大工具，支持TIFF和PNG格式，灰度和RGB图像，使用最近邻插值算法保持清晰的像素边缘效果。

## 功能特性

### 核心功能
- ✅ **多格式支持**：支持TIFF和PNG图像输入
- ✅ **多位深支持**：支持8位和16位灰度/RGB图像
- ✅ **RGB通道选择**：支持提取R/G/B单通道或转换为灰度
- ✅ **伪色图显示**：RGB通道自动生成对应颜色的伪色图
- ✅ **自动类型识别**：智能识别灰度或RGB图像
- ✅ **像素级放大**：使用最近邻插值，每个像素放大为N×N像素块
- ✅ **实时预览**：支持鼠标滚轮缩放，查看放大细节
- ✅ **多格式导出**：支持PNG和TIFF格式导出
- ✅ **位深度控制**：可选择8位或16位输出

### 技术规范
- **放大倍数**：1-50倍（整数）
- **插值算法**：最近邻插值（无平滑，无抗锯齿）
- **内存支持**：5000×5000像素输入图像，50倍放大
- **输入格式**：TIFF（8/16位灰度/RGB）、PNG（8位灰度/RGB）
- **通道选择**：灰度转换、R红色、G绿色、B蓝色
- **输出格式**：PNG、TIFF（8位或16位）

## 安装说明

### 系统要求
- Python 3.7 或更高版本
- Windows / macOS / Linux

### 依赖安装

使用pip安装所需依赖：

```bash
pip install -r requirements.txt
```

或手动安装：

```bash
pip install PyQt5 numpy Pillow
```

## 使用方法

### 启动应用

```bash
python main.py
```

### 操作步骤

1. **选择文件**
   - 点击"浏览..."按钮选择图像文件（TIFF或PNG）
   - 支持灰度和RGB图像，8位和16位（TIFF）
   - 或使用菜单 `文件 -> 打开图像` (Ctrl+O)
   - 应用自动识别图像类型和位深度

2. **选择通道**（仅RGB图像）
   - RGB图像会自动启用通道选择器
   - **灰度转换**：将RGB转换为灰度图（默认）
   - **R-红色**：提取并处理红色通道
   - **G-绿色**：提取并处理绿色通道
   - **B-蓝色**：提取并处理蓝色通道
   - 灰度图像会自动跳过此步骤

3. **设置放大倍数**
   - 使用数字输入框设置放大倍数（1-50倍）
   - 实时显示输出分辨率和内存需求

4. **预览效果**
   - 点击"预览"按钮查看放大效果
   - 使用鼠标滚轮（Ctrl+滚轮）缩放视图
   - 鼠标悬停显示像素坐标和灰度值
   - RGB图像可切换通道后重新预览

5. **导出图像**
   - 选择输出格式（PNG或TIFF）
   - 选择输出位深度（保持原始/8位/16位）
   - 点击"导出图像"保存结果

### 快捷键

- **Ctrl+O**: 打开图像
- **Ctrl+S**: 导出图像
- **Ctrl++**: 放大视图
- **Ctrl+-**: 缩小视图
- **Ctrl+0**: 适应窗口
- **Ctrl+1**: 实际大小（100%）
- **Ctrl+滚轮**: 缩放视图

### 查看控制

- **滚动条**: 平移图像
- **Ctrl+滚轮**: 缩放图像
- **鼠标悬停**: 显示像素信息

## 应用结构

```
SharpImageConverter/
├── core/                      # 核心处理模块
│   ├── __init__.py
│   ├── image_processor.py     # 图像处理核心
│   └── utils.py               # 工具函数
├── gui/                       # GUI组件
│   ├── __init__.py
│   ├── main_window.py         # 主窗口
│   ├── image_viewer.py        # 图像显示组件
│   └── controls.py            # 控制面板
├── main.py                    # 程序入口
├── requirements.txt           # 依赖列表
├── README.md                  # 本文件
└── Guideline.md               # 开发指南

```

## 技术实现

### 最近邻插值算法

使用numpy的`repeat`函数实现像素块复制：

```python
# 沿Y轴和X轴重复像素
expanded = np.repeat(image_array, scale_factor, axis=0)
expanded = np.repeat(expanded, scale_factor, axis=1)
```

这确保了：
- ✅ 无平滑效果
- ✅ 无抗锯齿
- ✅ 完美的像素块对齐
- ✅ 清晰的边缘保留

### 性能优化

1. **延迟处理**：放大倍数调整后延迟200ms再处理
2. **线程处理**：图像处理在独立线程中执行，保持UI响应
3. **内存保护**：超过1GB输出时显示警告
4. **高效显示**：显示时自动转换为8位，减少渲染负担

### 位深度处理

- **8位输入**: 直接处理，无需转换
- **16位输入**: 保持16位精度，显示时线性映射到8位
- **8位输出**: 16位图像线性缩放到0-255
- **16位输出**: 8位图像扩展到0-65535

## 输出文件命名

导出的文件名格式：

```
原文件名_放大倍数x_宽度x高度.格式
```

示例：
```
cell_image_4x_2000x2000.png
sample_10x_5000x5000.tiff
```

## 使用场景示例

### 场景1：灰度显微镜图像放大
```
输入：microscope_cell.tif (1024×1024, 16位灰度)
操作：4倍放大
输出：microscope_cell_4x_4096x4096.tiff (16位)
```

### 场景2：RGB荧光图像 - 红色通道伪色图
```
输入：fluorescence_rgb.tif (2048×2048, RGB 8位)
通道：选择 R-红色
操作：2倍放大
输出：fluorescence_rgb_2x_4096x4096.png (8位RGB红色伪色图)
说明：提取红色通道，显示和保存为红色伪色图
```

### 场景3：RGB彩色图像 - 绿色通道伪色图
```
输入：sample_rgb.tif (1500×1500, RGB 8位)
通道：选择 G-绿色
操作：10倍放大
输出：sample_rgb_10x_15000x15000.png (8位RGB绿色伪色图)
说明：提取绿色通道，显示和保存为绿色伪色图
```

### 场景4：RGB转灰度
```
输入：color_sample.tif (2000×2000, RGB 8位)
通道：灰度转换（默认）
操作：5倍放大
输出：color_sample_5x_10000x10000.png (8位灰度)
```

## 常见问题

### Q: 支持RGB彩色图像吗？
A: **支持**！从v1.1.0开始支持RGB TIFF图像。可以选择提取R/G/B单通道或转换为灰度。

### Q: PNG和TIFF图像有什么区别？
A: **处理方式不同**：
- **PNG RGB图像**：直接保持原始RGB格式，无需通道选择，适合彩色照片和截图
- **TIFF RGB图像**：支持通道选择功能，可提取R/G/B单通道或转换为灰度，适合科研图像分析
- **PNG灰度**和**TIFF灰度**：处理方式相同

### Q: TIFF RGB图像如何选择通道？
A: 加载TIFF RGB图像后，通道选择器会自动启用。选择想要的通道（R/G/B）或灰度转换，然后预览和导出。PNG图像无需此步骤。

### Q: 什么是伪色图？
A: 提取R/G/B通道后，会自动生成对应颜色的伪色图：
- **R通道**：红色伪色图（红色=灰度值，绿色和蓝色=0）
- **G通道**：绿色伪色图（绿色=灰度值，红色和蓝色=0）
- **B通道**：蓝色伪色图（蓝色=灰度值，红色和绿色=0）
这样可以更直观地查看单通道信息，类似荧光显微镜的效果。

### Q: 为什么放大后的图像看起来有"像素块"？
A: 这是最近邻插值的特性，用于保持清晰的像素边缘。如果需要平滑效果，请使用其他图像编辑软件。

### Q: 内存占用过大怎么办？
A: 减小放大倍数，或分批处理图像的不同区域。

### Q: 16位PNG导出失败怎么办？
A: PNG对16位支持有限。建议使用TIFF格式保存16位图像，或选择8位PNG导出。

### Q: 支持批量处理吗？
A: 当前版本仅支持单张图像处理。批量处理功能计划在未来版本中添加。

## 更新日志

### Version 1.1.0 (2025-10-10)
- ✨ **新增RGB图像支持**
- ✅ 自动识别灰度/RGB图像类型
- ✅ R/G/B单通道提取功能
- ✅ **伪色图显示和保存**（R/G/B通道对应红/绿/蓝伪色图）
- ✅ RGB转灰度功能
- ✅ 通道切换和实时预览
- 🐛 修复16位图像保存问题

### Version 1.0.0 (2025-10-09)
- ✨ 初始版本发布
- ✅ 支持8位和16位灰度TIFF
- ✅ 最近邻插值放大（1-50倍）
- ✅ 实时预览和缩放
- ✅ PNG/TIFF导出
- ✅ 完整的GUI界面

## 开发信息

- **开发框架**: PyQt5
- **图像处理**: NumPy, Pillow
- **开发语言**: Python 3.7+
- **许可协议**: MIT License

## 技术支持

如遇到问题或有功能建议，请查看：
- `Guideline.md` - 详细的技术实现指南
- 日志文件 `sharp_image_converter.log`

---

**注意**: 本工具专为科学图像处理设计，保持像素级精度和清晰边缘效果。
