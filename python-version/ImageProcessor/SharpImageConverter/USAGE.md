# 使用指南

## 快速开始

### Windows用户

双击 `run.bat` 即可启动应用（会自动检查依赖）

### 所有平台

```bash
python main.py
```

## 详细操作流程

### 1. 准备图像文件

确保你的图像文件满足以下条件：
- ✅ 格式：TIFF (.tif 或 .tiff)
- ✅ 类型：灰度图像（8位或16位）
- ✅ 尺寸：建议不超过5000×5000像素

### 2. 加载图像

**方法一：使用界面**
1. 点击"1. 选择文件"区域的"浏览..."按钮
2. 在文件对话框中选择TIFF文件
3. 等待加载完成

**方法二：使用菜单**
- 菜单栏 → 文件 → 打开图像 (Ctrl+O)

**加载成功后会显示：**
- 原始图像尺寸
- 位深度信息（8位或16位）
- 图像预览（自动适应窗口）

### 3. 设置放大参数

**调整放大倍数：**
1. 在"2. 设置放大倍数"区域
2. 使用数字输入框或上下箭头调整倍数（1-50）
3. 观察"3. 输出信息"区域的实时更新：
   - 输出分辨率
   - 内存需求估算

**内存警告：**
- 如果输出图像超过1GB，会显示 ⚠️ 警告标记
- 预览时会弹出确认对话框

### 4. 预览效果

**生成预览：**
1. 点击"预览"按钮
2. 等待处理完成（会显示进度提示）
3. 查看放大后的效果

**查看控制：**
- **Ctrl + 鼠标滚轮**：缩放视图
- **鼠标拖拽**：平移图像（使用滚动条）
- **Ctrl + +**：放大视图
- **Ctrl + -**：缩小视图
- **Ctrl + 0**：适应窗口大小
- **Ctrl + 1**：100%实际大小

**像素信息：**
- 鼠标悬停在图像上
- 状态栏左侧显示：坐标 (x, y) 和灰度值
- 状态栏右侧显示：当前缩放比例

### 5. 导出图像

**选择导出设置：**

在"4. 导出设置"区域：

1. **输出格式**：
   - PNG（推荐，通用性好）
   - TIFF（保留更多信息）

2. **输出位深**：
   - 保持原始（推荐）
   - 8位（标准灰度）
   - 16位（高精度灰度）

**执行导出：**
1. 点击"导出图像"按钮
2. 在保存对话框中选择位置
3. 文件名会自动生成：`原文件名_倍数x_分辨率.格式`
4. 如果文件已存在，会提示是否覆盖

**导出完成：**
- 弹出成功提示
- 状态栏显示保存路径

## 使用技巧

### 最佳实践

**1. 选择合适的放大倍数**
- 小细节查看：2-5倍
- 印刷输出：5-10倍
- 极限放大：10-50倍（注意内存）

**2. 内存管理**
- 原始图像越大，放大后内存占用越多
- 公式：内存(MB) = 宽 × 高 × 倍数² × 字节数 / 1048576
- 建议：输出图像保持在500MB以内

**3. 位深度选择**
- 原始8位 → 输出8位：无损
- 原始16位 → 输出16位：保留完整精度
- 原始16位 → 输出8位：降低精度（节省空间）
- 原始8位 → 输出16位：扩展位深（不增加信息）

**4. 格式选择**
- PNG：
  - ✅ 通用性好，大多数软件支持
  - ✅ 无损压缩，文件较小
  - ⚠️ 16位支持有限
  
- TIFF：
  - ✅ 完整支持8位和16位
  - ✅ 科学图像标准格式
  - ⚠️ 文件较大

### 常见场景

**场景1：显微镜图像放大**
```
原始：1024×1024, 16位
放大：4倍
输出：4096×4096, 16位 TIFF
内存：32 MB
```

**场景2：细胞图像展示**
```
原始：2048×2048, 8位
放大：2倍
输出：4096×4096, 8位 PNG
内存：16 MB
```

**场景3：印刷输出**
```
原始：1500×1500, 8位
放大：10倍
输出：15000×15000, 8位 PNG
内存：225 MB
```

## 故障排除

### 问题1：应用无法启动

**症状**：双击main.py或run.bat无反应

**解决方案**：
1. 检查Python版本：`python --version`（需要3.7+）
2. 检查依赖安装：`pip list | grep -E "PyQt5|numpy|Pillow"`
3. 手动安装依赖：`pip install -r requirements.txt`
4. 查看日志文件：`sharp_image_converter.log`

### 问题2：图像加载失败

**症状**：选择文件后弹出错误提示

**可能原因**：
- ❌ 不是TIFF格式
- ❌ 不是灰度图像（可能是RGB或RGBA）
- ❌ 文件损坏

**解决方案**：
1. 使用ImageJ或GIMP验证图像格式
2. 转换为灰度TIFF：
   ```python
   from PIL import Image
   img = Image.open('input.tif').convert('L')
   img.save('output.tif')
   ```

### 问题3：预览处理缓慢

**症状**：点击预览后长时间无响应

**可能原因**：
- 图像太大
- 放大倍数太高
- 内存不足

**解决方案**：
1. 减小放大倍数
2. 先在小区域测试
3. 关闭其他占用内存的程序

### 问题4：导出文件过大

**症状**：导出的PNG或TIFF文件太大

**解决方案**：
1. PNG格式通常比TIFF小
2. 8位比16位小一半
3. 考虑降低放大倍数
4. 使用外部压缩工具（如pngquant）

### 问题5：像素边缘不清晰

**症状**：放大后的图像看起来模糊

**这不是问题！**
- 本工具使用最近邻插值
- 专门设计用于保持清晰的像素块边缘
- 如果看到"像素块"效果，说明工作正常
- 如需平滑效果，请使用其他工具（如Photoshop的双三次插值）

## 高级用法

### 批量处理（通过脚本）

创建一个Python脚本：

```python
import sys
sys.path.insert(0, 'path/to/SharpImageConverter')

from core.image_processor import ImageProcessor
import glob

processor = ImageProcessor()

for input_file in glob.glob('input_folder/*.tif'):
    # 加载图像
    processor.load_tiff(input_file)
    
    # 放大4倍
    processor.expand_current_image(4)
    
    # 导出
    output_file = input_file.replace('.tif', '_4x.png')
    processor.save_image(output_file, format='PNG')
    print(f"处理完成: {output_file}")
```

### 程序化调用

```python
from core.image_processor import ImageProcessor

# 创建处理器
processor = ImageProcessor()

# 加载图像
img_array, size, bit_depth = processor.load_tiff('input.tif')
print(f"加载图像: {size}, {bit_depth}位")

# 放大图像
expanded = processor.expand_current_image(scale_factor=5)
print(f"放大后: {expanded.shape}")

# 保存结果
processor.save_image('output_5x.png', format='PNG', bit_depth=8)
print("保存完成")
```

## 性能参考

基于典型配置（Intel i5, 16GB RAM, SSD）：

| 原始尺寸 | 放大倍数 | 输出尺寸 | 预览时间 | 导出时间 | 内存占用 |
|---------|---------|----------|----------|----------|---------|
| 512×512 | 2x | 1024×1024 | <0.1s | <0.5s | 1 MB |
| 1024×1024 | 4x | 4096×4096 | <0.5s | <2s | 16 MB |
| 2048×2048 | 5x | 10240×10240 | <2s | <8s | 100 MB |
| 5000×5000 | 10x | 50000×50000 | <10s | <30s | 2.5 GB |

**注意**：实际性能取决于硬件配置和系统状态。

## 快捷键参考

### 文件操作
- `Ctrl+O` - 打开图像
- `Ctrl+S` - 导出图像
- `Ctrl+Q` - 退出程序

### 视图控制
- `Ctrl++` - 放大视图
- `Ctrl+-` - 缩小视图
- `Ctrl+0` - 适应窗口
- `Ctrl+1` - 100%实际大小
- `Ctrl+滚轮` - 缩放视图

### 其他
- `鼠标悬停` - 显示像素信息
- `鼠标拖拽滚动条` - 平移图像

---

**需要帮助？** 查看 `README.md` 或检查 `sharp_image_converter.log` 日志文件。
