# CellToolbox - Python版本

一个使用计算机视觉技术进行实时细胞检测和跟踪的强大工具。该工具箱提供基于USB摄像头的实时跟踪和静态照片分析功能。

## 功能特点

- 通过USB摄像头进行实时细胞检测和跟踪
- 静态照片分析
- 交互式参数调整
- 快照分析以优化参数
- 多个可视化窗口：
  - 主检测视图（带绿色边界框）
  - 分割视图（带白色矩形）
  - 用于参数计算的分析窗口

## 安装

1. 克隆仓库
2. 安装所需依赖：
```bash
pip install numpy opencv-python opencv-contrib-python scikit-image
```

## 使用方法

### 实时细胞跟踪 (`cell_tracking_for_usbcam.py`)

1. 运行程序：
```bash
python cell_tracking_for_usbcam.py
```

2. 程序将打开三个窗口：
   - **细胞检测控制面板**：用于参数调整
   - **细胞检测视图**：显示带有绿色边界框的检测到的细胞
   - **白色矩形视图**：显示带有白色填充矩形的检测到的细胞

3. 可调参数：
   - **面积**：细胞的最小和最大面积（像素）
   - **周长**：细胞的最小和最大周长（像素）
   - **圆度**：最小和最大圆度（0-1，1表示完全圆形）
   - **记忆帧数**：检测后继续跟踪细胞的帧数
   - **最大移动**：帧间允许的最大移动距离（像素）
   - **距离阈值**：细胞跟踪的最大距离

4. 控制按钮：
   - **拍摄分析快照**：捕获当前帧以优化参数
   - **更新参数**：应用当前参数值
   - **退出**：关闭程序

### 静态照片分析 (`cell_tracking_for_staticPhoto.py`)

1. 运行程序：
```bash
python cell_tracking_for_staticPhoto.py
```

2. 使用文件对话框选择要分析的图像

3. 程序将显示：
   - 带有检测到的细胞的原始图像
   - 分割掩码
   - 分析结果

## 参数优化

1. 在实时视图中点击"拍摄分析快照"
2. 在分析窗口中将区域标记为细胞或非细胞
3. 点击"计算最佳阈值"以计算最佳参数
4. 程序将根据标记数据建议参数

## 获得最佳结果的技巧

1. **光照**：确保光照条件一致且充足
2. **相机对焦**：调整相机对焦以获得清晰的细胞边界
3. **参数调整**：
   - 从面积约束开始
   - 根据细胞形状微调圆度
   - 根据细胞运动速度调整跟踪参数

## 故障排除

1. **未检测到细胞**：
   - 检查面积范围是否适合您的细胞
   - 确保适当的光照和对焦
   - 验证圆度约束是否过于严格

2. **假阳性**：
   - 增加最小面积
   - 收紧圆度范围
   - 使用快照分析优化参数

3. **跟踪问题**：
   - 如果细胞移动快，增加最大移动距离
   - 根据帧率调整记忆帧数
   - 根据应用调整距离阈值

## 依赖项

- numpy
- opencv-python
- opencv-contrib-python
- scikit-image

## 贡献

欢迎提交问题、复刻仓库并为任何改进创建拉取请求。
